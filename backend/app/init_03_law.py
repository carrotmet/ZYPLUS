# -*- coding: utf-8 -*-
"""
03 学科门类：法学 - 初始化脚本
包含：法学类、政治学类、社会学类、民族学类、马克思主义理论类、公安学类
"""

import sys
import os
import json

backend_path = 'D:/github.com/carrotmet/zyplusv2/backend'
if backend_path not in sys.path:
    sys.path.insert(0, backend_path)
os.chdir(backend_path)

from app.database import SessionLocal
from app import models

def get_or_create_discipline(db, name, code, description):
    """获取或创建学科门类"""
    discipline = db.query(models.Discipline).filter(models.Discipline.code == code).first()
    if not discipline:
        discipline = models.Discipline(name=name, code=code, description=description)
        db.add(discipline)
        db.commit()
        db.refresh(discipline)
        print(f"  创建学科门类: {name} (ID: {discipline.id})")
    else:
        print(f"  学科门类已存在: {name} (ID: {discipline.id})")
    return discipline

def get_or_create_category(db, name, code, discipline_id, description):
    """获取或创建专业类"""
    category = db.query(models.MajorCategory).filter(
        models.MajorCategory.code == code,
        models.MajorCategory.discipline_id == discipline_id
    ).first()
    if not category:
        category = models.MajorCategory(
            name=name, code=code, discipline_id=discipline_id, description=description
        )
        db.add(category)
        db.commit()
        db.refresh(category)
        print(f"    创建专业类: {name} (ID: {category.id})")
    else:
        print(f"    专业类已存在: {name} (ID: {category.id})")
    return category

def create_major_if_not_exists(db, name, code, category_id, description, duration, courses):
    """创建专业（如果不存在）"""
    existing = db.query(models.Major).filter(models.Major.code == code).first()
    if existing:
        print(f"      跳过: {name} (已存在)")
        return None
    
    major = models.Major(
        name=name,
        code=code,
        category_id=category_id,
        description=description,
        duration=duration,
        main_courses=json.dumps(courses, ensure_ascii=False)
    )
    db.add(major)
    db.commit()
    db.refresh(major)
    print(f"      创建专业: {name} (ID: {major.id})")
    return major

def init_law_data():
    """初始化法学学科数据"""
    print("=== 初始化 03 法学类数据 ===\n")
    db = SessionLocal()
    
    try:
        # 创建学科门类：法学
        discipline = get_or_create_discipline(
            db, "法学", "03",
            "法学学科门类，包含法学、政治学、社会学、民族学、马克思主义理论、公安学等专业类"
        )
        
        # 0301 法学类
        category = get_or_create_category(db, "法学类", "0301", discipline.id, 
            "研究法律、法律现象及其规律的学科")
        majors_data = [
            ("法学", "030101K", "培养系统掌握法学知识，熟悉我国法律和党的相关政策的专业人才",
             ["法理学", "宪法学", "民法学", "刑法学", "行政法与行政诉讼法", "民事诉讼法学", "刑事诉讼法学", "国际法"]),
            ("知识产权", "030102T", "培养具备知识产权专业知识的复合型应用型人才",
             ["知识产权法", "专利法", "商标法", "著作权法", "竞争法", "知识产权管理", "知识产权文献检索与应用"]),
            ("监狱学", "030103T", "培养从事监狱管理、罪犯教育改造等工作的专业人才",
             ["监狱学基础", "狱政管理学", "罪犯教育学", "罪犯心理学", "矫正教育学", "监狱法学", "刑事执行法学"]),
            ("信用风险管理与法律防控", "030104T", "培养信用风险管理和法律防控的复合型人才",
             ["信用管理学", "风险管理", "合同法", "担保法", "破产法", "金融法", "征信理论与实务"]),
            ("国际经贸规则", "030105T", "培养熟悉国际经贸规则的专业人才",
             ["国际经济学", "国际贸易法", "WTO规则", "国际投资法", "国际金融法", "国际商事仲裁", "海商法"]),
            ("司法警察学", "030106TK", "培养从事司法警察工作的专业人才",
             ["司法警察学", "狱政管理", "值庭与安检", "押解与看管", "法院执行实务", "警察法学", "警体技能"]),
            ("社区矫正", "030107TK", "培养从事社区矫正工作的专业人才",
             ["社区矫正学", "矫正教育学", "犯罪心理学", "社会工作", "社会心理学", "矫正社会学", "个案工作"]),
            ("纪检监察", "030108TK", "培养从事纪检监察工作的专业人才",
             ["纪检监察学", "党内法规学", "监察法学", "廉政学", "监督学", "纪律审查实务", "案件审理实务"]),
            ("国际法", "030109TK", "培养从事国际法律事务的专业人才",
             ["国际公法", "国际私法", "国际经济法", "国际组织法", "国际人权法", "国际环境法", "国际刑法"]),
            ("司法鉴定学", "030110TK", "培养从事司法鉴定工作的专业人才",
             ["司法鉴定概论", "法医临床学", "法医病理学", "司法精神病学", "物证技术学", "司法会计学", "声像资料鉴定"]),
            ("国家安全学", "030111TK", "培养从事国家安全工作的专业人才",
             ["国家安全学", "情报学", "国家安全战略", "国家安全管理", "反间谍工作", "保密工作", "反恐工作"]),
            ("海外利益安全", "030112TK", "培养保护海外利益安全的专业人才",
             ["海外利益安全概论", "国际安全", "风险管理", "海外投资法", "领事保护", "危机管理", "跨文化沟通"]),
        ]
        for name, code, desc, courses in majors_data:
            create_major_if_not_exists(db, name, code, category.id, desc, 4, courses)
        
        # 0302 政治学类
        category2 = get_or_create_category(db, "政治学类", "0302", discipline.id,
            "研究政治现象及其规律的学科")
        majors_data2 = [
            ("政治学与行政学", "030201", "培养从事政治学与行政学研究和实务的专业人才",
             ["政治学原理", "行政学概论", "中国政治制度", "西方政治制度", "公共政策分析", "公务员制度", "比较政治学"]),
            ("国际政治", "030202", "培养从事国际政治研究和外事工作的专业人才",
             ["国际政治学", "国际关系史", "外交学", "国际法", "区域与国别研究", "国际组织", "国际政治经济学"]),
            ("外交学", "030203", "培养从事外交外事工作的专业人才",
             ["外交学概论", "国际关系理论", "中国外交史", "当代国际关系", "谈判学", "领事业务", "外交礼仪"]),
            ("国际事务与国际关系", "030204T", "培养从事国际事务的复合型人才",
             ["国际关系理论", "国际法", "国际组织", "全球经济", "区域研究", "跨文化交流", "国际谈判"]),
            ("政治学、经济学与哲学", "030205T", "培养具有跨学科背景的复合型人才",
             ["政治学原理", "经济学原理", "哲学导论", "政治经济学", "西方政治思想史", "西方经济学说史", "西方哲学史"]),
            ("国际组织与全球治理", "030206TK", "培养从事国际组织工作的专业人才",
             ["国际组织概论", "全球治理", "国际法", "国际关系", "多边外交", "国际项目管理", "国际谈判"]),
        ]
        for name, code, desc, courses in majors_data2:
            create_major_if_not_exists(db, name, code, category2.id, desc, 4, courses)
        
        # 0303 社会学类
        category3 = get_or_create_category(db, "社会学类", "0303", discipline.id,
            "研究社会现象及其规律的学科")
        majors_data3 = [
            ("社会学", "030301", "培养从事社会学研究和实务的专业人才",
             ["社会学概论", "社会研究方法", "社会统计学", "社会心理学", "西方社会学理论", "中国社会思想史", "农村社会学"]),
            ("社会工作", "030302", "培养从事社会工作实务的专业人才",
             ["社会工作概论", "个案工作", "小组工作", "社区工作", "社会心理学", "社会福利与社会保障", "社会政策"]),
            ("人类学", "030303T", "培养从事人类学研究的专业人才",
             ["人类学概论", "文化人类学", "考古人类学", "语言人类学", "体质人类学", "民族学", "田野调查方法"]),
            ("女性学", "030304T", "培养从事性别研究和妇女工作的专业人才",
             ["女性学概论", "女性主义理论", "性别社会学", "妇女发展史", "妇女法学", "妇女与健康", "社会性别主流化"]),
            ("家政学", "030305T", "培养从事家政管理和服务的专业人才",
             ["家政学概论", "家庭教育学", "家庭管理学", "营养学", "服装学", "家庭护理", "家庭理财"]),
            ("老年学", "030306T", "培养从事老年服务和研究的专业人才",
             ["老年学概论", "老年心理学", "老年社会学", "老年护理学", "老年政策", "养老机构管理", "老年健康管理"]),
            ("社会政策", "030307T", "培养从事社会政策研究和制定的专业人才",
             ["社会政策概论", "社会保障", "社会救助", "社会福利", "住房政策", "教育政策", "医疗政策"]),
        ]
        for name, code, desc, courses in majors_data3:
            create_major_if_not_exists(db, name, code, category3.id, desc, 4, courses)
        
        # 0304 民族学类
        category4 = get_or_create_category(db, "民族学类", "0304", discipline.id,
            "研究民族和民族问题的学科")
        majors_data4 = [
            ("民族学", "030401", "培养从事民族学研究的专业人才",
             ["民族学概论", "人类学", "中国民族史", "民族理论与政策", "民族调查方法", "文化人类学", "民俗学"]),
        ]
        for name, code, desc, courses in majors_data4:
            create_major_if_not_exists(db, name, code, category4.id, desc, 4, courses)
        
        # 0305 马克思主义理论类
        category5 = get_or_create_category(db, "马克思主义理论类", "0305", discipline.id,
            "研究马克思主义理论的学科")
        majors_data5 = [
            ("科学社会主义", "030501", "培养从事科学社会主义研究和教学的专业人才",
             ["科学社会主义原理", "国际共产主义运动史", "当代世界社会主义", "中国特色社会主义", "马克思主义基本原理", "政治学原理", "社会学"]),
            ("中国共产党历史", "030502", "培养从事党史研究和教学的专业人才",
             ["中国共产党历史", "中国近现代史", "中华人民共和国史", "毛泽东思想", "中国特色社会主义理论", "党史文献学", "党的建设"]),
            ("思想政治教育", "030503", "培养从事思想政治教育工作的专业人才",
             ["思想政治教育学原理", "马克思主义哲学", "政治经济学", "科学社会主义", "伦理学", "教育学", "心理学"]),
            ("马克思主义理论", "030504T", "培养从事马克思主义理论研究的专业人才",
             ["马克思主义哲学", "马克思主义政治经济学", "科学社会主义", "马克思主义发展史", "马克思主义中国化", "国外马克思主义", "思想政治教育"]),
            ("工会学", "030505TK", "培养从事工会工作的专业人才",
             ["工会学概论", "劳动关系", "劳动法学", "工会组织", "集体谈判", "劳动争议处理", "职工民主管理"]),
        ]
        for name, code, desc, courses in majors_data5:
            create_major_if_not_exists(db, name, code, category5.id, desc, 4, courses)
        
        # 0306 公安学类
        category6 = get_or_create_category(db, "公安学类", "0306", discipline.id,
            "培养公安工作专业人才")
        majors_data6 = [
            ("治安学", "030601K", "培养从事治安管理工作的专业人才",
             ["治安学总论", "户政学", "治安秩序管理", "特种行业管理", "危险物品管理", "治安案件查处", "社区警务"]),
            ("侦查学", "030602K", "培养从事刑事侦查工作的专业人才",
             ["侦查学总论", "刑事案件侦查", "预审学", "犯罪现场勘查", "侦查措施", "刑事技术", "经济犯罪侦查"]),
            ("边防管理", "030603K", "培养从事边防管理工作的专业人才",
             ["边防管理学", "出入境管理", "边境管理", "边防检查", "涉外警务", "国际法", "边防勤务"]),
            ("禁毒学", "030604TK", "培养从事禁毒工作的专业人才",
             ["禁毒学", "毒品学", "毒品检验", "戒毒学", "禁毒情报", "禁毒法律法规", "国际禁毒合作"]),
            ("警犬技术", "030605TK", "培养从事警犬技术工作的专业人才",
             ["警犬学概论", "警犬训练学", "警犬使用学", "犬行为学", "犬病学", "刑事技术", "侦查学"]),
            ("经济犯罪侦查", "030606TK", "培养从事经济犯罪侦查的专业人才",
             ["经济犯罪侦查总论", "金融犯罪侦查", "涉税犯罪侦查", "走私犯罪侦查", "知识产权犯罪侦查", "会计基础", "经济法"]),
            ("边防指挥", "030607TK", "培养从事边防指挥工作的专业人才",
             ["边防指挥学", "边防战术", "边防勤务", "军事地形学", "边防通信", "边防管理", "应急处突"]),
            ("消防指挥", "030608TK", "培养从事消防指挥工作的专业人才",
             ["消防指挥学", "消防战术", "灭火技术", "建筑防火", "火灾调查", "应急救援", "消防通信"]),
            ("警卫学", "030609TK", "培养从事警卫工作的专业人才",
             ["警卫学", "警卫战术", "警卫勤务", "警卫指挥", "警卫技术", "治安管理学", "犯罪预防"]),
            ("公安情报学", "030610TK", "培养从事公安情报工作的专业人才",
             ["公安情报学", "情报搜集", "情报分析", "情报技术", "犯罪情报", "反恐情报", "网络安全情报"]),
            ("犯罪学", "030611TK", "培养从事犯罪研究和预防的专业人才",
             ["犯罪学", "犯罪心理学", "犯罪社会学", "犯罪预防", "刑事政策", "被害人学", "越轨社会学"]),
            ("公安管理学", "030612TK", "培养从事公安管理工作的专业人才",
             ["公安管理学", "公安领导学", "公安决策学", "公安组织行为学", "公安人力资源管理", "公安信息资源管理", "公安公共关系"]),
            ("涉外警务", "030613TK", "培养从事涉外警务工作的专业人才",
             ["涉外警务概论", "国际警务合作", "外国人管理", "出入境管理", "国际法", "涉外案件处置", "外交礼仪"]),
            ("国内安全保卫", "030614TK", "培养从事国内安全保卫工作的专业人才",
             ["国内安全保卫学", "国家安全学", "反恐怖概论", "宗教问题研究", "民族问题研究", "情报工作", "专案侦察"]),
            ("警务指挥与战术", "030615TK", "培养从事警务指挥与战术的专业人才",
             ["警务指挥学", "警务战术", "警务实战技能", "群体性事件处置", "反恐战术", "人质解救战术", "应急处突"]),
            ("技术侦查学", "030616TK", "培养从事技术侦查工作的专业人才",
             ["技术侦查学", "侦查情报", "电子侦查", "视听技术", "通信技术", "网络技术", "密码学"]),
            ("海警执法", "030617TK", "培养从事海警执法工作的专业人才",
             ["海警执法概论", "海洋法", "海上治安管理", "海上刑事执法", "海洋权益维护", "舰艇操纵", "海上救生"]),
            ("公安政治工作", "030618TK", "培养从事公安政治工作的专业人才",
             ["公安政治工作学", "思想政治教育", "公安党建", "公安队伍建设", "公安人事管理", "公安宣传", "警察心理学"]),
            ("移民管理", "030619TK", "培养从事移民管理工作的专业人才",
             ["移民管理概论", "出入境管理", "国籍管理", "难民管理", "移民法", "国际移民", "边境管理"]),
            ("出入境管理", "030620TK", "培养从事出入境管理工作的专业人才",
             ["出入境管理概论", "出入境证件鉴别", "出入境边防检查", "外国人管理", "出入境法律法规", "口岸管理", "边防勤务"]),
            ("反恐警务", "030621TK", "培养从事反恐警务工作的专业人才",
             ["反恐概论", "反恐情报", "反恐战术", "爆炸物品管理", "人质解救", "反恐法律法规", "危机谈判"]),
            ("消防政治工作", "030622TK", "培养从事消防政治工作的专业人才",
             ["消防政治工作", "思想政治教育", "消防队伍建设", "消防人事管理", "消防宣传", "消防心理学", "消防文化"]),
            ("铁路警务", "030623TK", "培养从事铁路警务工作的专业人才",
             ["铁路警务概论", "铁路治安管理学", "铁路刑事侦查", "铁路交通安全", "铁路车站勤务", "列车乘警勤务", "铁路警卫"]),
        ]
        for name, code, desc, courses in majors_data6:
            create_major_if_not_exists(db, name, code, category6.id, desc, 4, courses)
        
        print("\n=== 法学类数据初始化完成 ===")
        
    finally:
        db.close()

if __name__ == "__main__":
    init_law_data()
