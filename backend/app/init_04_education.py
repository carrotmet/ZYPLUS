# -*- coding: utf-8 -*-
"""
04 学科门类：教育学 - 初始化脚本
包含：教育学类、体育学类
"""

import sys
import os
import json

backend_path = 'D:/github.com/carrotmet/zyplusv2/backend'
if backend_path not in sys.path:
    sys.path.insert(0, backend_path)
os.chdir(backend_path)

from app.database import SessionLocal
from app import models

def get_or_create_discipline(db, name, code, description):
    """获取或创建学科门类"""
    discipline = db.query(models.Discipline).filter(models.Discipline.code == code).first()
    if not discipline:
        discipline = models.Discipline(name=name, code=code, description=description)
        db.add(discipline)
        db.commit()
        db.refresh(discipline)
        print(f"  创建学科门类: {name} (ID: {discipline.id})")
    else:
        print(f"  学科门类已存在: {name} (ID: {discipline.id})")
    return discipline

def get_or_create_category(db, name, code, discipline_id, description):
    """获取或创建专业类"""
    category = db.query(models.MajorCategory).filter(
        models.MajorCategory.code == code,
        models.MajorCategory.discipline_id == discipline_id
    ).first()
    if not category:
        category = models.MajorCategory(
            name=name, code=code, discipline_id=discipline_id, description=description
        )
        db.add(category)
        db.commit()
        db.refresh(category)
        print(f"    创建专业类: {name} (ID: {category.id})")
    else:
        print(f"    专业类已存在: {name} (ID: {category.id})")
    return category

def create_major_if_not_exists(db, name, code, category_id, description, duration, courses):
    """创建专业（如果不存在）"""
    existing = db.query(models.Major).filter(models.Major.code == code).first()
    if existing:
        print(f"      跳过: {name} (已存在)")
        return None
    
    major = models.Major(
        name=name,
        code=code,
        category_id=category_id,
        description=description,
        duration=duration,
        main_courses=json.dumps(courses, ensure_ascii=False)
    )
    db.add(major)
    db.commit()
    db.refresh(major)
    print(f"      创建专业: {name} (ID: {major.id})")
    return major

def init_education_data():
    """初始化教育学学科数据"""
    print("=== 初始化 04 教育学类数据 ===\n")
    db = SessionLocal()
    
    try:
        # 创建学科门类：教育学
        discipline = get_or_create_discipline(
            db, "教育学", "04",
            "教育学学科门类，包含教育学、体育学等专业类"
        )
        
        # 0401 教育学类
        category = get_or_create_category(db, "教育学类", "0401", discipline.id,
            "研究教育现象及其规律的学科")
        majors_data = [
            ("教育学", "040101", "培养从事教育研究和教学管理的专业人才",
             ["教育学原理", "教育心理学", "课程与教学论", "教育管理学", "教育研究方法", "中国教育史", "外国教育史"]),
            ("科学教育", "040102", "培养从事科学教育的专业人才",
             ["科学教育学", "物理学基础", "化学基础", "生物学基础", "地球科学", "科学史", "科学教学论"]),
            ("人文教育", "040103", "培养从事人文教育的专业人才",
             ["人文教育学", "文学", "历史学", "哲学", "艺术学", "文化学", "人文课程与教学论"]),
            ("教育技术学", "040104", "培养从事教育技术研究和应用的专业人才",
             ["教育技术学导论", "教学设计", "远程教育", "教育媒体与技术", "教育软件工程", "人工智能教育应用", "学习科学"]),
            ("艺术教育", "040105", "培养从事艺术教育的专业人才",
             ["艺术教育学", "音乐基础", "美术基础", "舞蹈基础", "戏剧基础", "艺术史", "艺术课程与教学论"]),
            ("学前教育", "040106", "培养从事学前教育的专业人才",
             ["学前教育学", "学前心理学", "学前卫生学", "幼儿园课程", "幼儿游戏", "儿童文学", "幼儿园管理"]),
            ("小学教育", "040107", "培养从事小学教育的专业人才",
             ["小学教育学", "小学心理学", "小学语文教学法", "小学数学教学法", "小学英语教学", "小学班级管理", "小学教育研究方法"]),
            ("特殊教育", "040108", "培养从事特殊教育的专业人才",
             ["特殊教育学", "特殊儿童心理学", "听力障碍儿童教育", "智力障碍儿童教育", "自闭症儿童教育", "特殊儿童评估", "康复训练"]),
            ("华文教育", "040109T", "培养从事华文教育的专业人才",
             ["华文教育概论", "对外汉语教学法", "中华文化", "华侨华人史", "东南亚文化", "华文教材教法", "跨文化交际"]),
            ("教育康复学", "040110TK", "培养从事教育康复的专业人才",
             ["教育康复学", "康复医学", "听力康复", "语言康复", "认知康复", "运动康复", "康复评估"]),
            ("卫生教育", "040111T", "培养从事学校卫生教育的专业人才",
             ["学校卫生学", "儿童少年卫生学", "健康教育", "营养学", "心理学", "急救医学", "传染病防控"]),
            ("认知科学与技术", "040112T", "培养从事认知科学研究的专业人才",
             ["认知科学导论", "认知心理学", "神经科学", "人工智能", "语言学", "哲学", "计算机科学"]),
            ("融合教育", "040113T", "培养从事融合教育的专业人才",
             ["融合教育概论", "特殊教育", "差异教学", "个别化教育计划", "辅助技术", "班级管理", "教育评估"]),
            ("劳动教育", "040114TK", "培养从事劳动教育的专业人才",
             ["劳动教育学", "劳动技能", "职业启蒙", "职业生涯规划", "生产劳动", "服务性劳动", "劳动安全"]),
            ("家庭教育", "040115T", "培养从事家庭教育的专业人才",
             ["家庭教育学", "儿童发展心理学", "亲子关系", "家庭咨询", "家庭理财", "家庭健康", "家庭文化"]),
            ("孤独症儿童教育", "040116TK", "培养从事孤独症儿童教育的专业人才",
             ["孤独症儿童教育概论", "孤独症儿童心理学", "应用行为分析", "结构化教学", "感觉统合训练", "社会交往训练", "语言沟通训练"]),
            ("人工智能教育", "040117TK", "培养从事人工智能教育的专业人才",
             ["人工智能基础", "机器学习", "教育数据挖掘", "智能教学系统", "编程教育", "机器人教育", "教育人工智能伦理"]),
            ("婴幼儿发展与健康管理", "040118T", "培养从事婴幼儿发展与健康管理的专业人才",
             ["婴幼儿发展心理学", "婴幼儿保育", "婴幼儿营养", "婴幼儿健康评估", "婴幼儿游戏", "托育机构管理", "家庭教育指导"]),
        ]
        for name, code, desc, courses in majors_data:
            create_major_if_not_exists(db, name, code, category.id, desc, 4, courses)
        
        # 0402 体育学类
        category2 = get_or_create_category(db, "体育学类", "0402", discipline.id,
            "研究体育现象及其规律的学科")
        majors_data2 = [
            ("体育教育", "040201", "培养从事体育教学的专业人才",
             ["体育教育学", "运动解剖学", "运动生理学", "体育心理学", "学校体育学", "田径", "球类运动", "体操"]),
            ("运动训练", "040202K", "培养从事运动训练的专业人才",
             ["运动训练学", "运动生理学", "运动心理学", "运动生物力学", "专项训练理论", "运动选材", "运动营养"]),
            ("社会体育指导与管理", "040203", "培养从事社会体育指导与管理的专业人才",
             ["社会体育学", "体育管理学", "健身理论与指导", "体育市场营销", "体育俱乐部管理", "社区体育", "体育旅游"]),
            ("武术与民族传统体育", "040204K", "培养从事武术与民族传统体育的专业人才",
             ["武术学", "民族传统体育概论", "太极拳", "散打", "套路", "传统养生", "武术史"]),
            ("运动人体科学", "040205", "培养从事运动人体科学研究的专业人才",
             ["运动解剖学", "运动生理学", "运动生物化学", "运动生物力学", "运动营养学", "运动医学", "体适能评定"]),
            ("运动康复", "040206T", "培养从事运动康复的专业人才",
             ["运动康复学", "运动解剖学", "运动生理学", "康复评定学", "物理治疗", "运动损伤学", "体能训练"]),
            ("休闲体育", "040207T", "培养从事休闲体育的专业人才",
             ["休闲体育概论", "体育旅游", "户外运动", "高尔夫", "网球", "健身健美", "体育俱乐部经营"]),
            ("体能训练", "040208T", "培养从事体能训练的专业人才",
             ["体能训练学", "运动解剖学", "运动生理学", "力量训练", "速度训练", "耐力训练", "柔韧训练", "功能性训练"]),
            ("冰雪运动", "040209T", "培养从事冰雪运动的专业人才",
             ["冰雪运动概论", "滑雪", "滑冰", "冰球", "冰壶", "雪上技巧", "冰雪场馆管理"]),
            ("电子竞技运动与管理", "040210TK", "培养从事电子竞技运动与管理的专业人才",
             ["电子竞技概论", "电竞项目训练", "电竞赛事运营", "电竞解说", "电竞心理学", "电竞俱乐部管理", "游戏设计基础"]),
            ("智能体育工程", "040211TK", "培养从事智能体育工程的专业人才",
             ["智能体育概论", "传感器技术", "数据分析", "体育人工智能", "可穿戴设备", "运动生物力学", "虚拟现实技术"]),
            ("体育旅游", "040212TK", "培养从事体育旅游的专业人才",
             ["体育旅游概论", "旅游学", "户外运动", "赛事旅游", "体育旅游营销", "体育旅游规划", "体育旅游管理"]),
            ("运动能力开发", "040213T", "培养从事运动能力开发的专业人才",
             ["运动能力开发学", "运动训练学", "运动心理学", "运动选材", "体能训练", "技能训练", "运动表现分析"]),
            ("足球运动", "040214TK", "培养从事足球运动的专业人才",
             ["足球训练学", "足球技战术", "足球教学法", "足球竞赛规则", "足球史", "足球产业", "足球康复"]),
            ("马术运动与管理", "040215TK", "培养从事马术运动与管理的专业人才",
             ["马术运动概论", "骑术", "马匹管理", "马术教学", "马术赛事", "马房管理", "马术俱乐部运营"]),
            ("体育康养", "040216T", "培养从事体育康养的专业人才",
             ["体育康养概论", "运动康复", "老年体育", "康养旅游", "健康管理", "中医养生", "营养与膳食"]),
            ("航空运动", "040217TK", "培养从事航空运动的专业人才",
             ["航空运动概论", "飞行原理", "航空法规", "跳伞", "滑翔", "热气球", "航空模型"]),
        ]
        for name, code, desc, courses in majors_data2:
            create_major_if_not_exists(db, name, code, category2.id, desc, 4, courses)
        
        print("\n=== 教育学类数据初始化完成 ===")
        
    finally:
        db.close()

if __name__ == "__main__":
    init_education_data()
