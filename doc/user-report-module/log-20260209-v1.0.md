# 用户报告模块更新日志

> **版本**: v1.0  
> **更新日期**: 2026-02-09  
> **更新类型**: 新模块设计  
> **关联文档**: `design.md`, `api.md`, `database.md`

---

## 一、更新概述

本次更新为用户报告模块的完整设计文档交付，包含模块架构设计、API接口设计、数据库设计三大核心文档。用户报告模块是职业规划导航平台的核心功能模块之一，与专业选择模块、职业详情模块并列。

---

## 二、新增内容

### 2.1 设计文档 (design.md)

| 章节 | 内容说明 |
|-----|---------|
| 设计概述 | 模块定位、设计目标、核心概念说明(三层模型、分层行动体系) |
| 模块架构设计 | 整体架构图、模块关系图、报告生成模块核心架构 |
| 报告结构设计 | 完整报告结构(50,000+字)、子报告字数分配表 |
| LazyLLM工作流设计 | 并行生成工作流架构、章节生成器设计、生成进度追踪 |
| 生成条件限制设计 | 条件检查矩阵、条件检查实现方案 |
| 用户界面设计 | 界面流程图、页面设计要点 |
| 模块独立性设计 | 依赖边界、接口隔离设计 |
| 错误处理与降级策略 | 错误分类处理、功能降级路径 |
| 性能设计 | 生成时间预估、资源消耗预估 |
| 安全与隐私设计 | 数据安全、隐私保护 |
| 实现计划 | 五阶段实施计划 |

### 2.2 API接口文档 (api.md)

| 接口分类 | 接口数量 | 说明 |
|---------|---------|-----|
| 条件检查接口 | 2个 | `/prerequisites`, `/prerequisites/validate` |
| 报告生成接口 | 4个 | `/generation` (CRUD), WebSocket流 |
| 报告查询接口 | 4个 | 报告列表、详情、内容、章节 |
| 报告导出接口 | 3个 | PDF、Word、Markdown导出 |
| 管理接口 | 2个 | 删除、历史记录 |
| 前端集成接口 | 1个 | 报告中心初始化数据 |

### 2.3 数据库文档 (database.md)

| 表名 | 用途 | 主要字段 |
|-----|-----|---------|
| `user_reports` | 报告元数据 | id, user_id, report_type, status, word_count等 |
| `report_chapters` | 报告章节内容 | id, report_id, chapter_code, content_html/markdown/plain |
| `generation_tasks` | 生成任务 | id, user_id, status, progress, current_stage等 |
| `report_snapshots` | 数据快照 | report_id, snapshot_type, snapshot_data |
| `report_exports` | 导出记录 | report_id, format, file_path等 |
| `generation_logs` | 生成日志 | task_id, log_level, message, details |

---

## 三、核心技术决策

### 3.1 报告生成架构

- **并行生成模式**: 采用LazyLLM `parallel + pipeline` 组合模式
- **并发控制**: 最多5个章节并行生成
- **字数保障**: 单章节字数不足时触发扩展生成

### 3.2 模块化设计

- **子报告独立**: 4种子报告可独立生成，降低信息门槛
- **完整报告组装**: 基于子报告结果组装完整报告
- **条件分级**: 不同报告类型有不同的生成条件

### 3.3 数据隔离

- **只读依赖**: 对用户画像、表单等模块只读访问
- **独立存储**: 报告内容独立存储，不影响源数据
- **数据快照**: 生成时保存用户数据快照，确保报告可追溯

---

## 四、报告内容规划

### 4.1 子报告字数分配

| 子报告 | 名称 | 字数要求 | 生成条件 |
|-------|-----|---------|---------|
| A | 用户画像深度分析报告 | ≥ 8,000字 | 接口层完整度 ≥ 60% |
| B | 用户表单分析报告 | ≥ 6,000字 | 表单填写次数 ≥ 3 |
| C | 三层职业规划建模报告 | ≥ 15,000字 | 可变层完整度 ≥ 50% |
| D | 分层递进行动体系报告 | ≥ 12,000字 | 核心层universal_skills有值 |

### 4.2 完整报告结构

总字数目标: **50,000+字**

- 封面与元信息: 500字
- 执行摘要: 2,000字
- 用户画像深度分析: 8,000字
- 用户表单与交互分析: 6,000字
- 三层职业规划结构化建模: 15,000字
- 分层递进行动体系设计: 12,000字
- 职业发展路径推荐: 4,000字
- 风险评估与应对策略: 2,500字
- 附录: 2,000+字

---

## 五、待实现功能清单

### Phase 1: 基础设施 (Week 1)
- [ ] 创建数据库表结构
- [ ] 实现SQLAlchemy实体类
- [ ] 实现PrerequisitesChecker条件检查器
- [ ] 编写单元测试

### Phase 2: 生成引擎 (Week 2)
- [ ] 搭建LazyLLM工作流
- [ ] 实现ChapterGenerator基类
- [ ] 实现各章节具体生成器
- [ ] 实现质量校验模块
- [ ] 实现报告组装引擎

### Phase 3: API层 (Week 3)
- [ ] 实现条件检查API
- [ ] 实现生成任务API
- [ ] 实现WebSocket进度推送
- [ ] 实现报告查询API
- [ ] 实现导出API

### Phase 4: 前端界面 (Week 4)
- [ ] 报告中心页面 (`report-center.html`)
- [ ] 报告生成页面 (`report-generation.html`)
- [ ] 报告阅读页面 (`report-viewer.html`)
- [ ] WebSocket客户端实现
- [ ] 导出功能实现

### Phase 5: 集成测试 (Week 5)
- [ ] 编写集成测试用例
- [ ] 性能测试与优化
- [ ] 用户验收测试
- [ ] 部署文档编写

---

## 六、关联模块影响

| 模块 | 影响类型 | 说明 |
|-----|---------|-----|
| 用户画像模块 | 读取依赖 | 读取接口层/可变层/核心层数据 |
| 用户表单模块 | 读取依赖 | 读取表单历史数据 |
| 专业数据模块 | 读取依赖 | 读取专业、学科信息 |
| 职业数据模块 | 读取依赖 | 读取职业、路径信息 |
| LazyLLM服务 | 调用依赖 | 调用生成工作流 |
| 导航栏 | UI扩展 | 新增"我的报告"入口 |
| 用户画像页 | UI扩展 | 新增"生成报告"卡片 |

---

## 七、风险提示

### 7.1 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|-----|---------|
| LLM生成不稳定 | 报告质量波动 | 质量校验+重试机制 |
| 生成时间过长 | 用户体验差 | 并行生成+进度展示 |
| Token消耗过高 | 成本增加 | 章节缓存+增量更新 |

### 7.2 业务风险

| 风险 | 影响 | 缓解措施 |
|-----|-----|---------|
| 用户数据不足 | 无法生成报告 | 清晰的条件提示+引导 |
| 报告内容同质化 | 用户满意度低 | 基于快照的个性化生成 |
| 导出格式兼容性 | 用户无法打开 | 多种格式+常见软件测试 |

---

## 八、参考文档

| 文档 | 路径 | 用途 |
|-----|-----|-----|
| Career-Planning Skill | `.agents/skills/Career-Planning/SKILL.md` | 三层模型、分层行动体系概念 |
| code-design-description Skill | `.agents/skills/code-design-description/SKILL.md` | 设计规范要求 |
| lazyllm-workflow-design Skill | `.agents/skills/lazyllm-workflow-design/SKILL.md` | LazyLLM工作流设计 |

---

## 九、文档清单

| 文档 | 路径 | 状态 |
|-----|-----|-----|
| 模块设计文档 | `doc/user-report-module/design.md` | ✅ 已完成 |
| API接口设计文档 | `doc/user-report-module/api.md` | ✅ 已完成 |
| 数据库设计文档 | `doc/user-report-module/database.md` | ✅ 已完成 |
| 更新日志 | `doc/user-report-module/log-20260209-v1.0.md` | ✅ 本文件 |

---

## 十、下一步行动

1. **Review设计文档**: 确认设计符合产品需求
2. **技术方案确认**: 确认LazyLLM工作流实现方案
3. **开发排期**: 按照Phase 1-5规划进行开发
4. **测试策略**: 制定详细的测试计划

---

**文档结束**
